{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/components/ui/button.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport React from \"react\";\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: \"primary\" | \"secondary\" | \"ghost\" | \"accent\" | \"outline\" | \"destructive\";\n  size?: \"sm\" | \"md\" | \"lg\" | \"icon\";\n  href?: string;\n}\n\nexport function Button({\n  className = \"\",\n  variant = \"primary\",\n  size = \"md\",\n  children,\n  href,\n  ...props\n}: ButtonProps) {\n  // Base: structural + focus + disabled\n  const baseClasses = \"inline-flex items-center justify-center font-medium transition-all duration-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--accent)] active:scale-[0.98] disabled:opacity-50 disabled:pointer-events-none cursor-pointer\";\n  \n  // Size variants\n  const sizeClasses = {\n    sm: \"h-8 px-3 text-sm rounded-[var(--radius-md)]\",\n    md: \"h-11 px-6 text-base rounded-[var(--radius-md)]\",\n    lg: \"h-14 px-8 text-lg rounded-[var(--radius-lg)]\",\n    icon: \"h-11 w-11 rounded-[var(--radius-md)]\",\n  };\n\n  // Aesthetic variants (Skeuomorphic)\n  // We use shadow-md for elevation 2, and remove/inset on active.\n  const variantClasses = {\n    primary: \"bg-[var(--primary)] text-[var(--primary-fg)] shadow-sm hover:brightness-105 active:brightness-95 active:shadow-inner border border-transparent\",\n    secondary: \"bg-[var(--secondary)] text-[var(--secondary-fg)] shadow-sm hover:brightness-105 active:brightness-95 active:shadow-inner border border-transparent\",\n    accent: \"bg-[var(--accent)] text-[var(--accent-fg)] shadow-md hover:brightness-105 active:brightness-95 active:shadow-inner border border-transparent\",\n    destructive: \"bg-red-500 text-white shadow-sm hover:bg-red-600 active:bg-red-700 active:shadow-inner border border-transparent\",\n    ghost: \"bg-transparent text-[var(--text)] hover:bg-[var(--surface-glass)] active:bg-[var(--border)]\",\n    outline: \"bg-transparent text-[var(--text)] border border-[var(--border)] hover:bg-[var(--surface-glass)] active:scale-[0.98]\",\n  };\n\n  const classes = `${baseClasses} ${sizeClasses[size]} ${variantClasses[variant]} ${className}`;\n\n  if (href) {\n    return (\n      <Link href={href} className={classes}>\n        {children}\n      </Link>\n    );\n  }\n\n  return (\n    <button className={classes} {...props}>\n      {children}\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;AASO,SAAS,OAAO,EACrB,YAAY,EAAE,EACd,UAAU,SAAS,EACnB,OAAO,IAAI,EACX,QAAQ,EACR,IAAI,EACJ,GAAG,OACS;IACZ,sCAAsC;IACtC,MAAM,cAAc;IAEpB,gBAAgB;IAChB,MAAM,cAAc;QAClB,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,MAAM;IACR;IAEA,oCAAoC;IACpC,gEAAgE;IAChE,MAAM,iBAAiB;QACrB,SAAS;QACT,WAAW;QACX,QAAQ;QACR,aAAa;QACb,OAAO;QACP,SAAS;IACX;IAEA,MAAM,UAAU,GAAG,YAAY,CAAC,EAAE,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,cAAc,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW;IAE7F,IAAI,MAAM;QACR,qBACE,6LAAC,0KAAI;YAAC,MAAM;YAAM,WAAW;sBAC1B;;;;;;IAGP;IAEA,qBACE,6LAAC;QAAO,WAAW;QAAU,GAAG,KAAK;kBAClC;;;;;;AAGP;KA7CgB"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/components/ui/input.tsx"],"sourcesContent":["\nimport * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport type InputProps = React.InputHTMLAttributes<HTMLInputElement>\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-11 w-full rounded-md border border-[var(--border)] bg-[var(--surface)] px-3 py-2 text-sm ring-offset-[var(--bg)] file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-[var(--text-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--primary)] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-[var(--text)] transition-colors\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAIA,MAAM,sBAAQ,2KAAgB,MAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,6LAAC;QACC,MAAM;QACN,WAAW,IAAA,4HAAE,EACX,qaACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/features/gradebook/components/gradebook-grid.tsx"],"sourcesContent":["import { useState } from \"react\";\nimport { GlassPanel } from \"@/components/ui/glass-panel\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Student } from \"@/features/teacher/types\";\nimport { GradeCategory, GradeItem, GradeEntry } from \"../types\";\nimport { Check, Loader2 } from \"lucide-react\";\n\ninterface GradebookGridProps {\n  students: Student[];\n  categories: GradeCategory[];\n  items: GradeItem[];\n  entries: GradeEntry[];\n  onUpdateGrade: (studentId: string, itemId: string, score: number) => void;\n  onEditItem?: (item: GradeItem) => void;\n  onSaveGrade?: (studentId: string, itemId: string) => Promise<void>;\n}\n\nexport function GradebookGrid({\n  students,\n  categories,\n  items,\n  entries,\n  onUpdateGrade,\n  onEditItem,\n  onSaveGrade\n}: GradebookGridProps) {\n  const [savingCells, setSavingCells] = useState<Record<string, boolean>>({});\n  \n  const getScore = (studentId: string, itemId: string) => {\n    const entry = entries.find(e => e.student === studentId && e.grade_item === itemId);\n    return entry ? entry.score : \"\";\n  };\n\n  const handleSave = async (studentId: string, itemId: string) => {\n    if (!onSaveGrade) return;\n    \n    const cellId = `${studentId}-${itemId}`;\n    setSavingCells(prev => ({ ...prev, [cellId]: true }));\n    try {\n        await onSaveGrade(studentId, itemId);\n    } finally {\n        setSavingCells(prev => ({ ...prev, [cellId]: false }));\n    }\n  };\n\n  return (\n    <div className=\"overflow-x-auto pb-4\">\n      <table className=\"w-full text-sm text-left border-collapse\">\n        <thead className=\"text-[var(--text-muted)] bg-[var(--surface-active)] uppercase rounded-t-lg\">\n          <tr>\n            <th className=\"px-4 py-3 sticky left-0 bg-[var(--surface-active)] z-10 w-48 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]\">\n                Aluno\n            </th>\n            {items.map((item) => (\n              <th \n                key={item.id} \n                className={`px-4 py-3 min-w-[120px] text-center border-l border-[var(--border)] ${onEditItem ? 'cursor-pointer hover:bg-[var(--surface-hover)] transition-colors group' : ''}`}\n                onClick={() => onEditItem?.(item)}\n              >\n                <div className=\"font-bold text-[var(--text)] flex items-center justify-center gap-1\">\n                  {item.title}\n                  {onEditItem && <span className=\"opacity-0 group-hover:opacity-60 text-xs\">✏️</span>}\n                </div>\n                <div className=\"text-[10px] opacity-70\">{item.max_score} pts</div>\n              </th>\n            ))}\n            <th className=\"px-4 py-3 min-w-[100px] text-center border-l border-[var(--border)] font-bold\">\n                Total\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          {students.map((student) => {\n            const studentId = student.id;\n            return (\n                <tr key={studentId} className=\"border-b border-[var(--border)] hover:bg-[var(--surface-hover)]\">\n                    <td className=\"px-4 py-3 font-medium sticky left-0 bg-[var(--background)] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]\">\n                        {student.name}\n                    </td>\n                    {items.map((item) => {\n                        const cellId = `${studentId}-${item.id}`;\n                        const isSaving = savingCells[cellId];\n                        const showButton = onSaveGrade; // Always show if save function is provided\n                        \n                        return (\n                        <td key={item.id} className=\"px-2 py-2 border-l border-[var(--border)] text-center\">\n                            <div className=\"flex items-center justify-center gap-1\">\n                                <Input \n                                    type=\"number\"\n                                    className=\"bg-transparent border-0 text-center h-8 focus:ring-1 focus:ring-[var(--primary)] px-1 w-16\"\n                                    value={getScore(studentId, item.id)}\n                                    onChange={(e) => {\n                                        const val = parseFloat(e.target.value);\n                                        if (!isNaN(val)) {\n                                            onUpdateGrade(studentId, item.id, val);\n                                        }\n                                    }}\n                                    max={item.max_score}\n                                    min={0}\n                                    step=\"0.1\"\n                                />\n                                {showButton && (\n                                    <Button\n                                        size=\"icon\"\n                                        variant=\"ghost\"\n                                        className=\"h-8 w-8 hover:bg-[var(--surface-active)] hover:text-[var(--primary)] text-[var(--text-muted)] rounded-full\"\n                                        onClick={() => handleSave(studentId, item.id)}\n                                        disabled={isSaving}\n                                    >\n                                        {isSaving ? (\n                                            <Loader2 size={14} className=\"animate-spin\" />\n                                        ) : (\n                                            <Check size={14} />\n                                        )}\n                                    </Button>\n                                )}\n                            </div>\n                        </td>\n                        );\n                    })}\n                    <td className=\"px-4 py-3 font-bold text-center border-l border-[var(--border)]\">\n                        {/* Calculate Total */}\n                        {items.reduce((acc, item) => {\n                             const score = entries.find(e => e.student === studentId && e.grade_item === item.id)?.score || 0;\n                             return acc + Number(score);\n                        }, 0)}\n                    </td>\n                </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/components/ui/dialog.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = ({\n  open,\n  onOpenChange,\n  children,\n}: {\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  children: React.ReactNode;\n}) => {\n  if (!open) return null;\n\n  const handleBackdropClick = (e: React.MouseEvent) => {\n    if (e.target === e.currentTarget) {\n      onOpenChange?.(false);\n    }\n  };\n\n  return (\n    <div \n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in-0\"\n      onClick={handleBackdropClick}\n    >\n      {children}\n    </div>\n  );\n}\n\nconst DialogContent = ({\n  className,\n  children,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"relative z-50 grid w-full max-w-lg gap-4 border bg-[var(--surface)] p-6 shadow-lg duration-200 sm:rounded-lg md:w-full\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </div>\n)\n\nconst DialogHeader = ({\n  className,\n  children,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </div>\n)\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst DialogTitle = ({\n  className,\n  children,\n  ...props\n}: React.HTMLAttributes<HTMLHeadingElement>) => (\n  <h2\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </h2>\n)\n\nexport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAGA;AAHA;;;AAKA,MAAM,SAAS,CAAC,EACd,IAAI,EACJ,YAAY,EACZ,QAAQ,EAKT;IACC,IAAI,CAAC,MAAM,OAAO;IAElB,MAAM,sBAAsB,CAAC;QAC3B,IAAI,EAAE,MAAM,KAAK,EAAE,aAAa,EAAE;YAChC,eAAe;QACjB;IACF;IAEA,qBACE,6LAAC;QACC,WAAU;QACV,SAAS;kBAER;;;;;;AAGP;KAzBM;AA2BN,MAAM,gBAAgB,CAAC,EACrB,SAAS,EACT,QAAQ,EACR,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,0HACA;QAED,GAAG,KAAK;kBAER;;;;;;MAZC;AAgBN,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,QAAQ,EACR,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,sDACA;QAED,GAAG,KAAK;kBAER;;;;;;MAZC;AAgBN,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,iEACA;QAED,GAAG,KAAK;;;;;;MATP;AAaN,MAAM,cAAc,CAAC,EACnB,SAAS,EACT,QAAQ,EACR,GAAG,OACsC,iBACzC,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,qDACA;QAED,GAAG,KAAK;kBAER;;;;;;MAZC"}},
    {"offset": {"line": 425, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/components/ui/label.tsx"],"sourcesContent":["\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Label = React.forwardRef<\n  HTMLLabelElement,\n  React.LabelHTMLAttributes<HTMLLabelElement>\n>(({ className, ...props }, ref) => (\n  <label\n    ref={ref}\n    className={cn(\n      \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-[var(--text)]\",\n      className\n    )}\n    {...props}\n  />\n))\nLabel.displayName = \"Label\"\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,4HAAE,EACX,iHACA;QAED,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 457, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/features/gradebook/components/create-assessment-modal.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { GradeCategory, GradeItem } from \"../types\";\nimport { Settings } from \"lucide-react\";\n\ninterface AssessmentModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  categories: GradeCategory[];\n  onSave: (item: Partial<GradeItem>) => Promise<void> | void;\n  onDelete?: (item: GradeItem) => void;\n  editItem?: GradeItem | null;\n  onManageCategories?: () => void;\n}\n\nexport function AssessmentModal({ \n  isOpen, \n  onClose, \n  categories, \n  onSave,\n  onDelete,\n  editItem,\n  onManageCategories\n}: AssessmentModalProps) {\n  const [title, setTitle] = useState(\"\");\n  const [categoryId, setCategoryId] = useState<string>(\"\");\n  const [maxScore, setMaxScore] = useState(\"10\");\n  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\n\n  const isEditMode = !!editItem;\n\n  // Pre-fill form when editing\n  useEffect(() => {\n    if (editItem) {\n      setTitle(editItem.title);\n      setCategoryId(editItem.category);\n      setMaxScore(String(editItem.max_score));\n      setDate(editItem.graded_at);\n    } else {\n      // Reset form for create mode\n      setTitle(\"\");\n      setCategoryId(\"\");\n      setMaxScore(\"10\");\n      setDate(new Date().toISOString().split('T')[0]);\n    }\n  }, [editItem, isOpen]);\n\n  const [isSaving, setIsSaving] = useState(false);\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    try {\n        await onSave({\n            id: editItem?.id, // Include id when editing\n            title,\n            category: categoryId,\n            max_score: parseFloat(maxScore),\n            graded_at: date\n        });\n        // Parent handles closing on success via isOpen prop\n    } catch (e) {\n        // Parent should handle errors, but if not caught:\n        console.error(e);\n    } finally {\n        setIsSaving(false);\n    }\n  };\n\n  const handleDelete = () => {\n    if (onDelete && editItem) {\n        onDelete(editItem);\n        onClose();\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle>{isEditMode ? \"Editar Avaliação\" : \"Nova Avaliação\"}</DialogTitle>\n        </DialogHeader>\n        <div className=\"grid gap-4 py-4\">\n          <div className=\"grid grid-cols-4 items-center gap-4\">\n            <Label htmlFor=\"title\" className=\"text-right\">Título</Label>\n            <Input \n              id=\"title\" \n              value={title} \n              onChange={(e) => setTitle(e.target.value)} \n              className=\"col-span-3\"\n              placeholder=\"Ex: Prova de Matemática\" \n            />\n          </div>\n          <div className=\"grid grid-cols-4 items-center gap-4\">\n            <Label htmlFor=\"category\" className=\"text-right\">Categoria</Label>\n            <div className=\"col-span-3 flex gap-2\">\n               <select\n                id=\"category\"\n                className=\"flex h-11 w-full rounded-md border border-[var(--border)] bg-[var(--surface)] px-3 py-2 text-sm ring-offset-[var(--bg)] placeholder:text-[var(--text-muted)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--primary)] focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-[var(--text)] transition-colors appearance-none flex-1\"\n                value={categoryId}\n                onChange={(e) => setCategoryId(e.target.value)}\n              >\n                <option value=\"\" disabled>Selecione...</option>\n                {categories.map((cat) => (\n                  <option key={cat.id} value={cat.id}>\n                    {cat.name}\n                  </option>\n                ))}\n              </select>\n              {onManageCategories && (\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\" \n                    size=\"icon\" \n                    onClick={onManageCategories}\n                    title=\"Gerenciar Categorias\"\n                    className=\"h-11 w-11 shrink-0\"\n                  >\n                    <Settings size={18} className=\"text-[var(--text-muted)]\" />\n                  </Button>\n              )}\n            </div>\n          </div>\n          <div className=\"grid grid-cols-4 items-center gap-4\">\n            <Label htmlFor=\"score\" className=\"text-right\">Valor Max.</Label>\n            <Input \n              id=\"score\" \n              type=\"number\" \n              value={maxScore} \n              onChange={(e) => setMaxScore(e.target.value)} \n              className=\"col-span-3\" \n            />\n          </div>\n          <div className=\"grid grid-cols-4 items-center gap-4\">\n            <Label htmlFor=\"date\" className=\"text-right\">Data</Label>\n            <Input \n              id=\"date\" \n              type=\"date\" \n              value={date} \n              onChange={(e) => setDate(e.target.value)} \n              className=\"col-span-3\" \n            />\n          </div>\n        </div>\n        <DialogFooter className={isEditMode ? \"sm:justify-between\" : \"\"}>\n          {isEditMode && (\n            <Button variant=\"destructive\" onClick={handleDelete} className=\"mr-auto\">\n                Excluir\n            </Button>\n          )}\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={onClose} disabled={isSaving}>Cancelar</Button>\n            <Button onClick={handleSave} disabled={!title || !categoryId || isSaving}>\n                {isSaving ? \"Salvando...\" : \"Salvar\"}\n            </Button>\n          </div>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 789, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/features/gradebook/components/manage-categories-modal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { GradeCategory } from \"../types\";\nimport { Trash2, Plus, Settings2 } from \"lucide-react\";\nimport { GlassPanel } from \"@/components/ui/glass-panel\";\n\ninterface ManageCategoriesModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  categories: GradeCategory[];\n  onCreate: (name: string, weight: number) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n}\n\nexport function ManageCategoriesModal({\n  isOpen,\n  onClose,\n  categories,\n  onCreate,\n  onDelete\n}: ManageCategoriesModalProps) {\n  const [newCatName, setNewCatName] = useState(\"\");\n  const [newCatWeight, setNewCatWeight] = useState(\"10\"); // Default weight\n  const [isCreating, setIsCreating] = useState(false);\n  const [isDeleting, setIsDeleting] = useState<string | null>(null);\n\n  const handleCreate = async () => {\n    if (!newCatName) return;\n    setIsCreating(true);\n    try {\n      await onCreate(newCatName, parseFloat(newCatWeight) || 0);\n      setNewCatName(\"\");\n      setNewCatWeight(\"10\");\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm(\"Tem certeza que deseja excluir esta categoria?\")) return;\n    setIsDeleting(id);\n    try {\n      await onDelete(id);\n    } finally {\n      setIsDeleting(null);\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Settings2 size={20} />\n            Gerenciar Categorias\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* Create New */}\n          <GlassPanel className=\"p-4 bg-[var(--surface-active)]/50\">\n            <h4 className=\"text-sm font-medium mb-3\">Nova Categoria</h4>\n            <div className=\"flex gap-2 items-end\">\n              <div className=\"flex-1 space-y-1\">\n                <Label htmlFor=\"cat-name\" className=\"text-xs text-[var(--text-muted)]\">Nome</Label>\n                <Input \n                  id=\"cat-name\"\n                  placeholder=\"Ex: Trabalhos\"\n                  value={newCatName}\n                  onChange={e => setNewCatName(e.target.value)}\n                  className=\"h-9\"\n                />\n              </div>\n              <div className=\"w-20 space-y-1\">\n                <Label htmlFor=\"cat-weight\" className=\"text-xs text-[var(--text-muted)]\">Peso (%)</Label>\n                <Input \n                  id=\"cat-weight\"\n                  type=\"number\"\n                  value={newCatWeight}\n                  onChange={e => setNewCatWeight(e.target.value)}\n                  className=\"h-9 text-center\"\n                />\n              </div>\n              <Button \n                onClick={handleCreate} \n                disabled={!newCatName || isCreating}\n                size=\"sm\"\n                className=\"h-9\"\n              >\n                {isCreating ? <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"/> : <Plus size={16} />}\n              </Button>\n            </div>\n          </GlassPanel>\n\n          {/* List */}\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium text-[var(--text-muted)] px-1\">Categorias Existentes</h4>\n            {categories.length === 0 ? (\n              <div className=\"text-center py-6 text-[var(--text-muted)] border rounded-lg border-dashed\">\n                Nenhuma categoria criada.\n              </div>\n            ) : (\n              <div className=\"space-y-2 max-h-[300px] overflow-y-auto pr-1\">\n                {categories.map(cat => (\n                  <div key={cat.id} className=\"flex items-center justify-between p-3 rounded-lg border border-[var(--border)] bg-[var(--surface)]\">\n                    <div className=\"flex flex-col\">\n                      <span className=\"font-medium text-sm\">{cat.name}</span>\n                      <span className=\"text-xs text-[var(--text-muted)]\">Peso: {cat.weight}%</span>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => handleDelete(cat.id)}\n                      disabled={isDeleting === cat.id}\n                      className=\"text-[var(--text-muted)] hover:text-red-500 hover:bg-red-500/10 h-8 w-8\"\n                    >\n                      {isDeleting === cat.id ? (\n                        <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-current\"/>\n                      ) : (\n                        <Trash2 size={14} />\n                      )}\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={onClose} className=\"w-full sm:w-auto\">\n            Fechar\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1116, "column": 0}, "map": {"version":3,"sources":["file:///Users/pedr/Developer/Safari%20Escolar/apps/web/src/app/teacher/%28dashboard%29/gradebook/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { GlassPanel } from \"@/components/ui/glass-panel\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, Plus } from \"lucide-react\";\nimport { GradebookGrid } from \"@/features/gradebook/components/gradebook-grid\";\nimport { AssessmentModal } from \"@/features/gradebook/components/create-assessment-modal\";\nimport { GradeCategory, GradeItem, GradeEntry } from \"@/features/gradebook/types\";\nimport { getCookie } from \"@/lib/utils\";\nimport { apiFetch } from \"@/lib/api\";\nimport { Student, Classroom } from \"@/features/teacher/types\";\n\nimport { ManageCategoriesModal } from \"@/features/gradebook/components/manage-categories-modal\";\n\nexport default function GradebookPage() {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isCategoryManagerOpen, setIsCategoryManagerOpen] = useState(false);\n  const [categories, setCategories] = useState<GradeCategory[]>([]);\n  const [items, setItems] = useState<GradeItem[]>([]);\n  const [entries, setEntries] = useState<GradeEntry[]>([]); \n  const [students, setStudents] = useState<Student[]>([]);\n  const [classrooms, setClassrooms] = useState<Classroom[]>([]);\n  const [activeClassroomId, setActiveClassroomId] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [editingItem, setEditingItem] = useState<GradeItem | null>(null);\n  const [isExporting, setIsExporting] = useState(false);\n\n  const getActiveClassroomId = () => activeClassroomId;\n\n  const loadGradebook = async (classId: string) => {\n    const resGrid = await fetch(`/api/grades/gradebook/grid?classroom_id=${classId}`, { credentials: \"include\" });\n    if (!resGrid.ok) {\n      const message = await resGrid.text();\n      throw new Error(message || \"Failed to load gradebook data\");\n    }\n    const gridData = await resGrid.json();\n    setCategories(gridData.categories || []);\n    setItems(gridData.items || []);\n    setEntries(gridData.entries || []);\n  };\n\n  const fetchData = async () => {\n    setIsLoading(true);\n    try {\n      const resStudents = await fetch(\"/api/students\", { credentials: \"include\" });\n      if (!resStudents.ok) throw new Error(\"Failed to fetch students\");\n      const studentsData: (Student & { animal_id?: string })[] = await resStudents.json();\n      \n      const mappedStudents = studentsData.map((s) => ({\n          ...s,\n          name: s.display_name || s.name || \"\",\n          avatar: s.animal_id,\n      }));\n      setStudents(mappedStudents);\n\n      const classId = mappedStudents[0]?.classroom;\n      if (classId) {\n        await loadGradebook(classId);\n      } else {\n        setCategories([]);\n        setItems([]);\n        setEntries([]);\n      }\n    } catch (error) {\n      console.error(\"Failed to load gradebook data\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const handleCreateCategory = async (name: string, weight: number) => {\n    const classId = getActiveClassroomId();\n    if (!classId) return;\n\n    try {\n      const res = await fetch(\"/api/grades/categories\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-CSRFToken\": getCookie(\"csrftoken\") || \"\"\n        },\n        credentials: \"include\",\n        body: JSON.stringify({\n            name,\n            weight,\n            classroom: classId\n        })\n      });\n\n      if (!res.ok) {\n        const message = await res.text();\n        throw new Error(message || \"Erro ao criar categoria\");\n      }\n\n      await loadGradebook(classId);\n    } catch (error: any) {\n      console.error(\"Failed to create category:\", error);\n      alert(`Erro ao criar categoria: ${error.message}`);\n    }\n  };\n\n  const handleDeleteCategory = async (id: string) => {\n    try {\n        const res = await fetch(`/api/grades/categories/${id}`, {\n            method: \"DELETE\",\n            headers: {\n                \"X-CSRFToken\": getCookie(\"csrftoken\") || \"\"\n            },\n            credentials: \"include\"\n        });\n\n        if (res.ok) {\n             const classId = getActiveClassroomId();\n             if (classId) {\n                 await loadGradebook(classId);\n             } else {\n                 setCategories(prev => prev.filter(c => c.id !== id));\n             }\n        } else {\n             alert(\"Erro ao excluir categoria (pode estar em uso)\");\n        }\n    } catch (error) {\n        console.error(\"Failed to delete category\", error);\n    }\n  };\n\n\n  const handleSaveAssessment = async (newItem: Partial<GradeItem>) => {\n    const csrfToken = getCookie(\"csrftoken\") || \"\";\n    const classId = getActiveClassroomId();\n    if (!classId) throw new Error(\"No classroom found\");\n    \n    try {\n        if (newItem.id && !newItem.id.startsWith(\"item-\")) {\n            // Edit existing item\n            const res = await fetch(`/api/grades/items/${newItem.id}`, {\n                method: \"PATCH\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-CSRFToken\": csrfToken\n                },\n                credentials: \"include\",\n                body: JSON.stringify(newItem)\n            });\n            \n            if (!res.ok) throw new Error(\"Failed to update assessment\");\n            await loadGradebook(classId);\n        } else {\n            // Create new item\n            const res = await fetch(\"/api/grades/items\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-CSRFToken\": csrfToken\n                },\n                credentials: \"include\",\n                body: JSON.stringify({\n                    ...newItem,\n                    classroom: classId\n                })\n            });\n\n            if (!res.ok) {\n                const err = await res.text();\n                throw new Error(`Failed to create assessment: ${err}`);\n            }\n            await loadGradebook(classId);\n        }\n        setEditingItem(null);\n        setIsModalOpen(false);\n    } catch (error: any) {\n        console.error(\"Save assessment error:\", error);\n        alert(error.message);\n    }\n  };\n\n  const handleEditItem = (item: GradeItem) => {\n    setEditingItem(item);\n    setIsModalOpen(true);\n  };\n\n  const handleOpenCreateModal = () => {\n    setEditingItem(null);\n    setIsModalOpen(true);\n  };\n\n  const handleCloseModal = () => {\n    setIsModalOpen(false);\n    setEditingItem(null);\n  };\n\n  const handleDeleteAssessment = async (item: GradeItem) => {\n    if (!window.confirm(`Tem certeza que deseja excluir a avaliação \"${item.title}\"? Esta ação não pode ser desfeita.`)) {\n        return;\n    }\n\n    const classId = getActiveClassroomId();\n    try {\n        const res = await fetch(`/api/grades/items/${item.id}`, {\n            method: \"DELETE\",\n            headers: {\n                \"X-CSRFToken\": getCookie(\"csrftoken\") || \"\"\n            },\n            credentials: \"include\"\n        });\n\n        if (!res.ok) {\n            const message = await res.text();\n            throw new Error(message || \"Erro ao excluir avaliação\");\n        }\n\n        if (classId) {\n            await loadGradebook(classId);\n        } else {\n            setItems(prev => prev.filter(i => i.id !== item.id));\n            setEntries(prev => prev.filter(e => e.grade_item !== item.id));\n        }\n    } catch (error: any) {\n        console.error(\"Failed to delete assessment\", error);\n        alert(error.message);\n    }\n  };\n\n  const handleUpdateGrade = (studentId: string, itemId: string, score: number) => {\n    setEntries(prev => {\n        const existing = prev.find(e => e.student === studentId && e.grade_item === itemId);\n        if (existing) {\n            return prev.map(e => e.id === existing.id ? { ...e, score } : e);\n        }\n        return [...prev, {\n            id: `temp-${Date.now()}`, // Temporary ID until saved\n            grade_item: itemId,\n            student: studentId,\n            score\n        }];\n    });\n  };\n\n  const handleSaveGrade = async (studentId: string, itemId: string) => {\n    const entry = entries.find(e => e.student === studentId && e.grade_item === itemId);\n    const classId = getActiveClassroomId();\n    if (!entry || !classId) return;\n\n    try {\n        const payload = [{\n            student: studentId,\n            grade_item: itemId,\n            score: entry.score\n        }];\n\n        const res = await fetch(\"/api/grades/entries/bulk_update_grades\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": getCookie(\"csrftoken\") || \"\"\n            },\n            credentials: \"include\",\n            body: JSON.stringify(payload)\n        });\n\n        if (!res.ok) {\n             const errText = await res.text();\n             throw new Error(`Failed to save grade: ${res.status} ${res.statusText}\\n${errText}`);\n        }\n        \n        await loadGradebook(classId);\n    } catch (error: any) {\n        console.error(\"Error saving grade:\", error);\n        alert(`Erro ao salvar nota: ${error.message}`);\n    }\n  };\n\n  const handleExport = async () => {\n    const classId = getActiveClassroomId();\n    if (!classId) {\n        alert(\"Nenhuma turma ativa para exportar.\");\n        return;\n    }\n\n    setIsExporting(true);\n    try {\n        const res = await fetch(`/api/grades/gradebook/export?classroom_id=${classId}`, {\n            credentials: \"include\"\n        });\n\n        if (!res.ok) {\n            const errText = await res.text();\n            throw new Error(errText || \"Falha ao exportar dados\");\n        }\n\n        const blob = await res.blob();\n        const url = window.URL.createObjectURL(blob);\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.download = `gradebook-${classId}.csv`;\n        document.body.appendChild(link);\n        link.click();\n        link.remove();\n        window.URL.revokeObjectURL(url);\n    } catch (error: any) {\n        console.error(\"Export error:\", error);\n        alert(`Erro ao exportar: ${error.message}`);\n    } finally {\n        setIsExporting(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6 pb-24\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n           <h1 className=\"text-2xl font-bold\">Diário de Classe</h1>\n           <p className=\"text-[var(--text-muted)]\">Gerencie notas e avaliações</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button \n            variant=\"outline\" \n            onClick={handleExport}\n            className=\"gap-2\"\n            disabled={isExporting}\n          >\n            <Download size={16} />\n            {isExporting ? \"Exportando...\" : \"Exportar\"}\n          </Button>\n          <Button onClick={handleOpenCreateModal} className=\"gap-2\">\n              <Plus size={18} />\n              Nova Avaliação\n          </Button>\n        </div>\n      </div>\n\n      <GlassPanel className=\"p-4 rounded-[var(--radius-xl)]\">\n        {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n               <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--primary)]\"></div>\n            </div>\n        ) : items.length === 0 ? (\n             <div className=\"text-center py-12 text-[var(--text-muted)]\">\n                <p>Nenhuma avaliação cadastrada para esta turma.</p>\n                <Button variant=\"ghost\" onClick={handleOpenCreateModal}>Criar primeira avaliação</Button>\n             </div>\n        ) : (\n            <GradebookGrid\n                students={students}\n                categories={categories}\n                items={items}\n                entries={entries}\n                onUpdateGrade={handleUpdateGrade}\n                onEditItem={handleEditItem}\n                onSaveGrade={handleSaveGrade}\n            />\n        )}\n      </GlassPanel>\n\n      <AssessmentModal\n        isOpen={isModalOpen}\n        onClose={handleCloseModal}\n        categories={categories}\n        onSave={handleSaveAssessment}\n        onDelete={handleDeleteAssessment}\n        editItem={editingItem}\n        onManageCategories={() => setIsCategoryManagerOpen(true)}\n      />\n\n      <ManageCategoriesModal\n        isOpen={isCategoryManagerOpen}\n        onClose={() => setIsCategoryManagerOpen(false)}\n        categories={categories}\n        onCreate={handleCreateCategory}\n        onDelete={handleDeleteCategory}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}